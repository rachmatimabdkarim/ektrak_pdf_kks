
<div class="flex flex-col h-full bg-slate-50 relative">
  <!-- Header -->
  <header class="bg-blue-900 text-white p-4 shadow-md flex justify-between items-center shrink-0 flex-wrap gap-2 z-20">
    <div class="flex items-center gap-3">
      <div class="p-2 bg-blue-800 rounded-lg">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-200"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>
      </div>
      <div>
        <h1 class="text-xl font-bold tracking-tight">Ekstraktor pdf KKS Koding dan PM</h1>
        <p class="text-blue-200 text-xs">Kantor Guru dan Tenaga Kependidikan Provinsi Maluku Utara</p>
      </div>
    </div>
    
    <div class="flex items-center gap-2">
      <!-- API Key Input Toggle -->
      <div class="relative flex items-center">
         @if (showApiKeyInput()) {
           <input 
             type="password" 
             [ngModel]="apiKey()" 
             (ngModelChange)="apiKey.set($event)"
             placeholder="Tempel Gemini API Key..." 
             class="px-3 py-1.5 text-sm rounded bg-blue-800 border border-blue-600 text-white placeholder-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-400 w-48 transition-all"
           >
         }
         <button (click)="toggleApiKey()" class="ml-2 p-1.5 hover:bg-blue-800 rounded text-blue-200 hover:text-white flex items-center gap-1" title="Set API Key">
           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
           <span class="text-xs font-medium">API Key</span>
         </button>

         <!-- Help Button -->
         <button (click)="toggleHelp()" class="ml-1 p-1.5 hover:bg-blue-800 rounded text-yellow-300 hover:text-yellow-100 flex items-center gap-1" title="Bantuan / Cara Dapat Key">
           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>
         </button>
      </div>

      <div class="h-6 w-px bg-blue-700 mx-1"></div>

      <!-- Process Button -->
      <button 
        (click)="startProcessing()"
        [disabled]="pendingCount() === 0 || isProcessingQueue()"
        class="px-4 py-1.5 text-sm font-medium rounded flex items-center gap-2 shadow-sm transition
               bg-indigo-600 hover:bg-indigo-500 text-white
               disabled:bg-slate-700 disabled:text-slate-400 disabled:cursor-not-allowed">
        @if (isProcessingQueue()) {
          <svg class="animate-spin h-4 w-4" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
          Memproses...
        } @else {
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
          Mulai Ekstraksi ({{ pendingCount() }})
        }
      </button>

      <button 
        (click)="reset()"
        class="px-3 py-1.5 text-sm bg-blue-800 hover:bg-blue-700 text-white rounded transition">
        Reset
      </button>
      <button 
        (click)="downloadExcel()"
        [disabled]="processedFiles().length === 0"
        class="px-4 py-1.5 text-sm bg-green-600 hover:bg-green-500 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium rounded flex items-center gap-2 shadow-sm transition">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
        Download Excel
      </button>
    </div>
  </header>

  <!-- Help Modal -->
  @if (showHelp()) {
    <div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200" (click)="toggleHelp()">
      <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full overflow-hidden" (click)="$event.stopPropagation()">
        <div class="bg-blue-50 p-4 border-b border-blue-100 flex justify-between items-center">
          <h3 class="font-bold text-blue-900 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>
            Apa itu API Key?
          </h3>
          <button (click)="toggleHelp()" class="text-slate-400 hover:text-slate-600">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
        <div class="p-6 text-slate-700 text-sm space-y-4">
          <p>
            Aplikasi ini membutuhkan <strong>Google Gemini API Key</strong> agar dapat membaca dan mengekstrak data dari file PDF Anda secara otomatis. Ini gratis!
          </p>
          
          <div class="space-y-3">
            <h4 class="font-semibold text-slate-900">Cara Mendapatkannya:</h4>
            <ol class="list-decimal list-inside space-y-2 ml-1">
              <li>
                Buka website <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600 hover:underline font-medium">Google AI Studio</a>.
              </li>
              <li>Login menggunakan akun Google (Gmail) Anda.</li>
              <li>Klik tombol biru bertuliskan <strong>"Create API key"</strong>.</li>
              <li>Salin kode panjang yang muncul (biasanya diawali huruf 'AI...').</li>
              <li>Kembali ke sini, klik tombol "API Key" di atas, dan tempel (paste) kodenya.</li>
            </ol>
          </div>

          <div class="bg-yellow-50 border border-yellow-200 p-3 rounded text-yellow-800 text-xs">
            <strong>Keamanan:</strong> Kunci API Anda hanya disimpan di browser laptop ini (LocalStorage) dan dikirim langsung ke Google untuk memproses data. Tidak disimpan di server pihak lain.
          </div>
        </div>
        <div class="p-4 bg-slate-50 border-t border-slate-100 text-right">
          <button (click)="toggleHelp()" class="px-4 py-2 bg-blue-600 text-white rounded font-medium text-sm hover:bg-blue-700">
            Saya Mengerti
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Main Content -->
  <main class="flex-1 overflow-hidden flex flex-col md:flex-row">
    
    <!-- Left Sidebar: Uploader & Status -->
    <aside class="w-full md:w-80 bg-white border-r border-slate-200 flex flex-col h-1/3 md:h-full shrink-0">
      
      <!-- Drop Zone -->
      <div class="p-4 border-b border-slate-100">
        <div 
          class="border-2 border-dashed border-blue-200 bg-blue-50/50 rounded-xl p-6 text-center hover:bg-blue-50 transition cursor-pointer relative"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave($event)"
          (drop)="onDrop($event)">
          
          <input 
            type="file" 
            multiple 
            accept="application/pdf"
            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
            (change)="onFileSelected($event)"
          />
          
          <div class="flex flex-col items-center gap-2 text-blue-800">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-50"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
            <span class="font-semibold text-sm">Upload PDF</span>
            <span class="text-xs text-blue-600/70">Klik atau Drag file ke sini</span>
          </div>
        </div>
      </div>

      <!-- File List -->
      <div class="flex-1 overflow-y-auto p-2 space-y-2">
        @if (fileList().length === 0) {
          <div class="flex flex-col items-center justify-center h-40 text-slate-400 text-center px-4">
             <p class="text-sm">Belum ada file.</p>
             <p class="text-xs">Upload banyak file sekaligus, lalu tekan tombol "Mulai Ekstraksi" di kanan atas.</p>
          </div>
        }

        @for (file of fileList(); track file.id) {
          <div class="flex items-center gap-3 p-3 rounded-lg border border-slate-100 bg-white shadow-sm animate-in fade-in slide-in-from-left-2">
            <div class="w-8 h-8 rounded-full flex items-center justify-center shrink-0"
              [class.bg-slate-100]="file.status === 'pending'"
              [class.text-slate-500]="file.status === 'pending'"
              [class.bg-blue-100]="file.status === 'processing'"
              [class.text-blue-600]="file.status === 'processing'"
              [class.bg-green-100]="file.status === 'done'"
              [class.text-green-600]="file.status === 'done'"
              [class.bg-red-100]="file.status === 'error'"
              [class.text-red-600]="file.status === 'error'"
            >
              @if (file.status === 'pending') {
                <span class="text-xs font-mono">...</span>
              } @else if (file.status === 'processing') {
                <svg class="animate-spin h-4 w-4" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
              } @else if (file.status === 'done') {
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
              }
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium truncate text-slate-700">{{ file.file.name }}</p>
              <p class="text-xs text-slate-400 capitalize">{{ file.status }}</p>
            </div>
          </div>
        }
      </div>

      <!-- Stats Footer -->
      <div class="p-3 bg-slate-50 border-t border-slate-200 text-xs text-slate-500 flex justify-between">
        <span>Antrian: {{ pendingCount() }}</span>
        <span>Sukses: {{ processedFiles().length }}</span>
      </div>
    </aside>

    <!-- Right Area: Data Table -->
    <section class="flex-1 flex flex-col min-w-0 bg-slate-100 overflow-hidden relative">
      @if (processedFiles().length === 0) {
        <div class="absolute inset-0 flex flex-col items-center justify-center text-slate-400 p-8">
          <div class="bg-white p-8 rounded-full shadow-sm mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="text-blue-200"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
          </div>
          <h3 class="text-lg font-medium text-slate-600">Menunggu Data</h3>
          <p class="text-center max-w-md mt-2">Upload file PDF di panel kiri, lalu tekan "Mulai Ekstraksi" di atas untuk memproses data.</p>
        </div>
      } @else {
        <div class="flex-1 overflow-auto">
          <div class="inline-block align-middle">
            <table class="divide-y divide-slate-200 border-separate border-spacing-0">
              <thead class="bg-slate-50 sticky top-0 z-10">
                <tr>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[100px] sticky left-0 z-20 shadow-sm">File</th>
                  <th scope="col" class="px-3 py-3.5 text-center text-xs font-semibold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[100px] sticky left-[100px] z-20 shadow-sm">Tipe</th>
                  
                  <!-- PM Specific (Grouped: KEPSEK) -->
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-pink-600 uppercase tracking-wider bg-pink-50 border-b border-pink-200 min-w-[80px]">PM: Sasaran Kepsek</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-pink-600 uppercase tracking-wider bg-pink-50 border-b border-pink-200 min-w-[120px]">PM: PNBP (Kepsek)</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-pink-600 uppercase tracking-wider bg-pink-50 border-b border-pink-200 min-w-[120px]">PM: Non-PNBP (Kepsek)</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-pink-600 uppercase tracking-wider bg-pink-50 border-b border-pink-200 min-w-[120px]">PM: Total (Kepsek)</th>

                  <!-- PM Specific (Grouped: GURU) -->
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-pink-700 uppercase tracking-wider bg-pink-100 border-b border-pink-300 min-w-[80px]">PM: Sasaran Guru</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-pink-700 uppercase tracking-wider bg-pink-100 border-b border-pink-300 min-w-[120px]">PM: PNBP (Per 1 Guru)</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-pink-700 uppercase tracking-wider bg-pink-100 border-b border-pink-300 min-w-[120px]">PM: Non-PNBP (Per 1 Guru)</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-pink-700 uppercase tracking-wider bg-pink-100 border-b border-pink-300 min-w-[120px]">PM: Total (Per 1 Guru)</th>

                   <!-- PM Specific (GRAND TOTAL) -->
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-red-600 uppercase tracking-wider bg-red-50 border-b border-red-200 min-w-[150px]">PM: Grand Total</th>

                  <!-- Legacy/Koding (Grouped) -->
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-purple-600 uppercase tracking-wider bg-purple-50 border-b border-purple-200 min-w-[150px]">Koding: Sasaran</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-purple-600 uppercase tracking-wider bg-purple-50 border-b border-purple-200 min-w-[120px]">Koding: PNBP</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-purple-600 uppercase tracking-wider bg-purple-50 border-b border-purple-200 min-w-[120px]">Koding: Non-PNBP</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-purple-600 uppercase tracking-wider bg-purple-50 border-b border-purple-200 min-w-[120px]">Koding: Total</th>

                  <!-- General Info -->
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[150px]">Pihak 1</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[150px]">Pihak 2</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[120px]">No. KKS 1</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[120px]">No. KKS 2</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[200px]">Tentang</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[80px]">Hari</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[100px]">Tanggal</th>
                  
                  <!-- Pihak 1 Details -->
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-blue-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[120px]">P1: Nama</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-blue-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[120px]">P1: NIP</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-blue-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[120px]">P1: Jabatan</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-blue-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[150px]">P1: Alamat</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-blue-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[100px]">P1: HP</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-blue-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[120px]">P1: Email</th>
                  
                  <!-- Pihak 2 Details -->
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-green-600 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[120px]">P2: Nama</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-green-600 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[120px]">P2: NIP</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-green-600 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[120px]">P2: Jabatan</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-green-600 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[150px]">P2: Alamat</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-green-600 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[100px]">P2: HP</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-green-600 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[120px]">P2: Email</th>
                  
                  <!-- Keuangan Umum -->
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[120px]">Setoran Kas</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-orange-600 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[120px]">Rek: No</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-orange-600 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[120px]">Rek: Nama</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-orange-600 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[100px]">Rek: Bank</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[120px]">Jangka Waktu</th>
                  <th scope="col" class="px-3 py-3.5 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider bg-slate-50 border-b border-slate-200 min-w-[50px] sticky right-0">Aksi</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-200 bg-white">
                @for (item of processedFiles(); track item.id) {
                  
                  <tr class="hover:bg-blue-50/30 transition-colors group">
                    <!-- Sticky File Name -->
                    <td class="whitespace-nowrap px-3 py-2 text-xs text-slate-500 max-w-[100px] truncate sticky left-0 bg-white z-10 border-r border-slate-100" [title]="item.fileName">
                      {{ item.fileName }}
                    </td>

                    <!-- Sticky Contract Type -->
                    <td class="px-1 py-1 sticky left-[100px] bg-white z-10 border-r border-slate-100">
                      <div class="flex justify-center">
                        @if (item.data.contractType === 'PM') {
                          <span class="inline-flex items-center rounded-md bg-pink-50 px-2 py-1 text-xs font-medium text-pink-700 ring-1 ring-inset ring-pink-700/10">PM</span>
                        } @else if (item.data.contractType === 'KODING') {
                          <span class="inline-flex items-center rounded-md bg-purple-50 px-2 py-1 text-xs font-medium text-purple-700 ring-1 ring-inset ring-purple-700/10">KODING</span>
                        } @else {
                          <span class="inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10">?</span>
                        }
                      </div>
                    </td>

                    <!-- PM Columns: KEPSEK -->
                    <td class="px-1 py-1" [class.bg-slate-100]="item.data.contractType !== 'PM'"><input type="text" [disabled]="item.data.contractType !== 'PM'" [(ngModel)]="item.data.sasaranKepsek" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-white focus:bg-white disabled:opacity-50 disabled:cursor-not-allowed"></td>
                    <td class="px-1 py-1" [class.bg-slate-100]="item.data.contractType !== 'PM'"><input type="text" [disabled]="item.data.contractType !== 'PM'" [(ngModel)]="item.data.pnbpKepsek" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-white focus:bg-white disabled:opacity-50 disabled:cursor-not-allowed text-right"></td>
                    <td class="px-1 py-1" [class.bg-slate-100]="item.data.contractType !== 'PM'"><input type="text" [disabled]="item.data.contractType !== 'PM'" [(ngModel)]="item.data.nonPnbpKepsek" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-white focus:bg-white disabled:opacity-50 disabled:cursor-not-allowed text-right"></td>
                    <td class="px-1 py-1" [class.bg-slate-100]="item.data.contractType !== 'PM'"><input type="text" [disabled]="item.data.contractType !== 'PM'" [(ngModel)]="item.data.totalKepsek" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-white focus:bg-white disabled:opacity-50 disabled:cursor-not-allowed text-right font-medium text-pink-700"></td>

                    <!-- PM Columns: GURU -->
                    <td class="px-1 py-1" [class.bg-slate-100]="item.data.contractType !== 'PM'"><input type="text" [disabled]="item.data.contractType !== 'PM'" [(ngModel)]="item.data.sasaranGuru" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-white focus:bg-white disabled:opacity-50 disabled:cursor-not-allowed"></td>
                    <td class="px-1 py-1" [class.bg-slate-100]="item.data.contractType !== 'PM'"><input type="text" [disabled]="item.data.contractType !== 'PM'" [(ngModel)]="item.data.pnbpGuru" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-white focus:bg-white disabled:opacity-50 disabled:cursor-not-allowed text-right"></td>
                    <td class="px-1 py-1" [class.bg-slate-100]="item.data.contractType !== 'PM'"><input type="text" [disabled]="item.data.contractType !== 'PM'" [(ngModel)]="item.data.nonPnbpGuru" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-white focus:bg-white disabled:opacity-50 disabled:cursor-not-allowed text-right"></td>
                    <td class="px-1 py-1" [class.bg-slate-100]="item.data.contractType !== 'PM'"><input type="text" [disabled]="item.data.contractType !== 'PM'" [(ngModel)]="item.data.totalGuru" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-white focus:bg-white disabled:opacity-50 disabled:cursor-not-allowed text-right font-medium text-pink-700"></td>

                    <!-- PM Columns: Grand Total -->
                    <td class="px-1 py-1" [class.bg-slate-100]="item.data.contractType !== 'PM'"><input type="text" [disabled]="item.data.contractType !== 'PM'" [(ngModel)]="item.data.totalBiayaPelatihanPM" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-white focus:bg-white disabled:opacity-50 disabled:cursor-not-allowed text-right font-bold text-red-700"></td>

                    <!-- Legacy/Koding Columns -->
                    <td class="px-1 py-1" [class.bg-slate-100]="item.data.contractType !== 'KODING'"><textarea rows="1" [disabled]="item.data.contractType !== 'KODING'" [(ngModel)]="item.data.sasaran" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 resize-none hover:bg-white focus:bg-white disabled:opacity-50 disabled:cursor-not-allowed"></textarea></td>
                    <td class="px-1 py-1" [class.bg-slate-100]="item.data.contractType !== 'KODING'"><input type="text" [disabled]="item.data.contractType !== 'KODING'" [(ngModel)]="item.data.biayaPnbp" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-white focus:bg-white disabled:opacity-50 disabled:cursor-not-allowed text-right"></td>
                    <td class="px-1 py-1" [class.bg-slate-100]="item.data.contractType !== 'KODING'"><input type="text" [disabled]="item.data.contractType !== 'KODING'" [(ngModel)]="item.data.biayaNonPnbp" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-white focus:bg-white disabled:opacity-50 disabled:cursor-not-allowed text-right"></td>
                    <td class="px-1 py-1" [class.bg-slate-100]="item.data.contractType !== 'KODING'"><input type="text" [disabled]="item.data.contractType !== 'KODING'" [(ngModel)]="item.data.totalBiaya" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-white focus:bg-white disabled:opacity-50 disabled:cursor-not-allowed text-right font-medium text-purple-700"></td>

                    <!-- General Info -->
                    <td class="px-1 py-1"><textarea rows="1" [(ngModel)]="item.data.pihak1" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 resize-none hover:bg-slate-50 focus:bg-white"></textarea></td>
                    <td class="px-1 py-1"><textarea rows="1" [(ngModel)]="item.data.pihak2" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 resize-none hover:bg-slate-50 focus:bg-white"></textarea></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.nomorKksPihak1" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.nomorKksPihak2" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    <td class="px-1 py-1"><textarea rows="1" [(ngModel)]="item.data.kksTentang" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 resize-none hover:bg-slate-50 focus:bg-white"></textarea></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.hariKks" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.tanggalKks" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    
                    <!-- P1 -->
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.namaPihak1" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.nipPihak1" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.jabatanPihak1" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    <td class="px-1 py-1"><textarea rows="1" [(ngModel)]="item.data.alamatPihak1" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 resize-none hover:bg-slate-50 focus:bg-white"></textarea></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.hpPihak1" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.emailPihak1" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>

                    <!-- P2 -->
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.namaPihak2" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.nipPihak2" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.jabatanPihak2" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    <td class="px-1 py-1"><textarea rows="1" [(ngModel)]="item.data.alamatPihak2" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 resize-none hover:bg-slate-50 focus:bg-white"></textarea></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.hpPihak2" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.emailPihak2" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>

                    <!-- Keuangan Umum -->
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.setoranKasNegara" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white text-right"></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.rekeningNomor" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.rekeningNama" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.rekeningBank" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>
                    <td class="px-1 py-1"><input type="text" [(ngModel)]="item.data.jangkaWaktu" class="w-full text-sm border-0 bg-transparent focus:ring-1 focus:ring-blue-500 rounded px-2 py-1 text-slate-900 hover:bg-slate-50 focus:bg-white"></td>

                    <td class="whitespace-nowrap px-3 py-2 text-right sticky right-0 bg-white group-hover:bg-blue-50/30 transition-colors shadow-sm">
                       <button (click)="removeFile(item.id)" class="text-slate-300 hover:text-red-500 p-1 rounded opacity-0 group-hover:opacity-100 transition-all" title="Hapus baris">
                         <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                       </button>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      }
    </section>
  </main>
</div>
